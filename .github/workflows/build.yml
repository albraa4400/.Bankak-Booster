name: Manual NDK Update Build
on: [push, workflow_dispatch]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install System Tools
        run: |
          sudo apt update
          sudo apt install -y python3-pip build-essential git zip unzip zlib1g-dev libffi-dev libssl-dev autoconf automake libtool
          pip3 install --user --upgrade buildozer cython kivy

      - name: Manual NDK Download (Your Idea)
        run: |
          # تحميل إصدار 25b يدوياً ووضعه في مكان يراه النظام إجبارياً
          wget https://dl.google.com/android/repository/android-ndk-r25b-linux.zip
          unzip -q android-ndk-r25b-linux.zip
          # إخبار النظام بمكان الـ NDK الجديد
          echo "ANDROID_NDK_HOME=$(pwd)/android-ndk-r25b" >> $GITHUB_ENV

      - name: Run Buildozer
        run: |
          rm -rf .buildozer
          # تشغيل البناء مع الإشارة للمجلد الذي حملناه يدوياً
          yes | buildozer android debug
